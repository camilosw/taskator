//knockout-sortable | (c) 2012 Ryan Niemeyer | http://www.opensource.org/licenses/mit-license
(function(a,b,c){var d=function(b){var c={},d=a.utils.unwrapObservable(b());return d.data?(c.foreach=d.data,c.name=d.template,c.afterAdd=d.afterAdd,c.beforeRemove=d.beforeRemove,c.afterRender=d.afterRender,c.includeDestroyed=d.includeDestroyed,c.templateEngine=d.templateEngine):c.foreach=b(),d.afterRender?c.afterRender=function(b,c){a.bindingHandlers.sortable.afterRender.call(c,b,c),d.afterRender.call(c,b,c)}:c.afterRender=a.bindingHandlers.sortable.afterRender,c};a.bindingHandlers.sortable={init:function(e,f,g,h,i){var j=a.utils.unwrapObservable(f()),k=d(f),l=a.bindingHandlers.sortable,m=j.connectClass||l.connectClass,n=j.allowDrop===c?l.allowDrop:j.allowDrop,o=j.beforeMove||l.beforeMove,p=j.afterMove||l.afterMove,q=j.options||l.options;return a.isObservable(n)||typeof n=="function"?a.computed({read:function(){var b=a.utils.unwrapObservable(n),c=typeof b=="function"?b.call(this,k.foreach):b;a.utils.toggleDomNodeCssClass(e,m,c)},disposeWhenNodeIsRemoved:e},this):a.utils.toggleDomNodeCssClass(e,m,n),b(e).data("ko_sortList",k.foreach),b(e).sortable(a.utils.extend(q,{update:function(c,d){var e,f,g,h,i=d.item.data("ko_sortItem");if(i){e=d.item.data("ko_parentList"),f=d.item.parent().data("ko_sortList"),g=a.utils.arrayIndexOf(d.item.parent().children(),d.item[0]);if(o||p)h={item:i,sourceParent:e,sourceIndex:e.indexOf(i),targetParent:f,targetIndex:g,cancelDrop:!1};if(o){o.call(this,h,c,d);if(h.cancelDrop){b(d.sender).sortable("cancel");return}}g>=0&&(e.remove(i),f.splice(g,0,i)),d.item.remove(),p&&p.call(this,h,c,d)}},connectWith:"."+m})),a.utils.domNodeDisposal.addDisposeCallback(e,function(){b(e).sortable("destroy")}),a.bindingHandlers.template.init(e,function(){return k},g,h,i)},update:function(b,c,e,f,g){var h=d(c);a.bindingHandlers.template.update(b,function(){return h},e,f,g)},afterRender:function(c,d){a.utils.arrayForEach(c,function(a){a.nodeType===1&&(b(a).data("ko_sortItem",d),b(a).data("ko_parentList",b(a).parent().data("ko_sortList")))})},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}}})(ko,jQuery)